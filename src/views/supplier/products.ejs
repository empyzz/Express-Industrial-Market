<!-- Cabeçalho da Página -->
<% if (typeof error_msg !== 'undefined' && error_msg.length > 0) { %>
    <div class="alert alert--error" style="margin: 1.5rem;">
        <i class="fas fa-exclamation-circle alert__icon"></i>
        <div class="alert__content">
            <strong>Por favor, corrija os seguintes erros:</strong>
            <ul>
                <% error_msg.forEach(msg => { %>
                    <li><%= msg %></li>
                <% }) %>
            </ul>
        </div>
        <button class="alert__close" aria-label="Fechar">&times;</button>
    </div>
<% } %>

<header class="dashboard-header">
    <h1>Meus Produtos</h1>
    <p>Gerencie o catálogo de produtos da sua loja.</p>
</header>

<!-- Seção Principal com a Tabela de Produtos -->
<section class="dashboard-section">
    <div class="section-header">
        <h2>Todos os Produtos (<%= products.length %>)</h2>
        <a href="/supplier/products/new" class="btn btn--primary">
            <i class="fa-solid fa-plus"></i> Adicionar Novo Produto
        </a>
    </div>

    <!-- Tabela de Produtos -->
    <div class="table-responsive">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Produto</th>
                    <th>Categoria</th>
                    <th>Preço</th>
                    <th>Estoque</th>
                    <th>Status</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                <% if (products.length > 0) { %>
                    <% products.forEach(product => { %>
                        <tr>
                            <td>
                                <!-- Adicionar imagem em miniatura é um bom toque visual -->
                                <div class="product-table-info">
                                        <img src="<%= product.images?.[0]?.url || '/images/placeholder-product.png' %>" alt="<%= product.name %>" class="product-table-image">
                                    <div>
                                        <strong><%= product.name %></strong>
                                        <small>SKU: <%= product.id.substring(0, 8) %></small>
                                    </div>
                                </div>
                            </td>
                            <td><%= product.category.name %></td>
                            <td>R$ <%= product.price.toFixed(2).replace('.', ',') %></td>
                            <td><%= product.stockQuantity %> <%= product.unit %></td>
                            <td>
                                <% if (product.isActive) { %>
                                    <span class="badge badge-success">Ativo</span>
                                <% } else { %>
                                    <span class="badge badge-draft">Inativo</span>
                                <% } %>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <a href="/supplier/products/<%= product.id %>/edit" class="btn-icon" title="Editar">
                                        <i class="fa-solid fa-pen"></i>
                                    </a>
                                    <form action="/supplier/products/<%= product.id %>?_method=DELETE" method="POST" style="display: inline;">
                                        <button type="submit" class="btn-icon danger" title="Excluir" onclick="return confirm('Tem certeza que deseja excluir este produto?');">
                                            <i class="fa-solid fa-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    <% }) %>
                <% } else { %>
                    <!-- Estado de Vazio -->
                    <tr>
                        <td colspan="6">
                            <div class="empty-state">
                                <i class="fa-solid fa-box-open"></i>
                                <p style="margin-bottom: 16px;">Você ainda não cadastrou nenhum produto.</p>
                                <a href="/supplier/products/new" class="btn btn--primary">Cadastrar Primeiro Produto</a>
                            </div>
                        </td>
                    </tr>
                <% } %>
            </tbody>
        </table>
    </div>
</section>
